---
layout: post
title: 'NSZombie只能用在debug模式下'
category: iOS
tags: NSZombie
---

调试程序时遇到最多的问题是程序crash，在crash之前，会给出一些堆栈信息以供调试，定位错误的位置。但有的时候，这些堆栈信息很莫名其妙，分析不出有用的信息，这个时候该怎么办呢？

其实大多数的crash是由于使用已经释放的对象引起的，对于这类的crash，我们可以使用NSZombie来帮助我们定位错误。NSZombie可以翻译成僵尸变量，僵尸大家都知道，挂了之后还能蹦跶，NSZombie的实现功能和它类似。正常情况下，如果一个对象的retainCount为0，它是应该被释放的，但是如果在Xcode中选中Enable Zombie Objects的话，这部分内存是不释放的，而是存入一块特定的内存区。如果有谁试图去访问这块内存区的僵尸变量，程序会给出具体的报错信息，而不是直接crush，这样对我们调试程序有很大的帮助。

需要注意的是Enable Zombie Objects只能在调试的时候使用，因为它hold住本应该释放的内存以供我们调试。所以在release工程的时候，记得把这个选项勾掉，否则的话，会出现内存使用线性增长的情况。类似于新浪微博的信息流，用户在滑动的时候，cell会不断重用，并且不在屏幕显示的cell会释放掉已经分配的内存，在这样的前提且没有内存泄露的情况下，内存仍会不断的增长，原因就是没有勾掉僵尸变量。


