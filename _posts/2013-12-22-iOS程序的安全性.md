---
layout: post
title: 'iOS程序的安全性'
category: iOS
tags: 安全
---


昨天听了[吴航](http://weibo.com/hangcom?topnav=1&wvr=5&topsug=1)关于[iOS逆向](http://weibo.com/iosre?topnav=1&wvr=5&topsug=1)的分享，会后也聊了一会，总结如下：

----

###一、我们的App安全吗？

越狱，0%的安全性；

不越狱，99%的安全性；

为什么这么说呢？因为如果你选择越狱的话，实际上就是放弃了苹果给你提供的强有力的安全屏障，突破沙盒限制，获得root权限，给黑客充足的施展拳脚的空间。

那为什么即使不越狱也不能达到100%的安全性呢，因为这个世界上总是不排除存在那么几个顶尖级别的高手，能让你在不察觉的情况下主动越狱的。

----

###二、为什么越狱之后就不安全了呢？

先说下越狱之后我们能够做什么吧。对于一台越狱的设备，这台设备上运行的所有App的相关信息对于我们来说都是透明的，举例如下：

1 class-dump-z 导出所有的类信息，包括成员变量和方法，但不包括源码实现

2 IDA 导出方法的伪代码实现。 你是不是要问，为什么只给伪码而不给源码呢？实际上对于我们来说，并不需要知道每个方法是具体怎么实现的，只需要知道这个方法的作用和它的执行上下文的逻辑即可。

3 Reveal 展示UI的层级结构

4 GDB 程序运行时动态调试程序，可以打印出调试信息

5 Cycript可以让程序不执行它应当执行的方法，而去执行我们想让它执行的任何方法

6 Snoop it 一个集成了上面大多数功能的可视化工具。

。。。。。。

再加上这个利器：

7 Charles 拦截所有网络请求的包

利用这些工具获取的信息，对我们来说就足够了解一个App的内部逻辑了。然后，就可以做一些deb的插件实现一些功能了，比如：

1 对于微信，我们找到发送信息和接收信息的接口。拦截这些接口的所有信息，然后发给我。

2 对于一些手机银行应用，找到转账的接口，伪造转账请求，你账户上的钱就不知不觉的丢失了。

我可以拿到我任何感兴趣的信息，你的手机现在对我来说就是一台肥肥的肉机了。对于重要的个人信息，财产信息都造成了极大的风险。
我们还可以做一些有意思的插件，比如：

1 微信的附近的人。这个功能是基于用户当前的位置信息实现的，我们可以把位置信息改成任意的位置，这样，足不出户，就实现了全球的人的功能啦。

----
###三、有没有防御措施呢？

答案是没有，我们是不可能构建一个完全安全的App，能做的就是尽量加大App被破解的复杂度。

1 增大文件数量。如微信，有巨多的文件，光是把所有的文件名读下来也得需要个一年半载。

2 方法名混淆。这样就不能直接根据方法的名称猜测方法的作用了吧

3 敏感数据不存磁盘，放内存里，想取得话来别嫌麻烦，来内存拿吧

4 网络请求加时间戳，防止请求被伪造。

5 各种加密措施都上一遍。

6 重要模块用C写，反编译？找个汇编大牛来吧。

。。。。。。

当然这些都是治标不治本的方法，破解是肯定能行的，就是考虑成本的问题了。这些都是针对越狱用户来说的，如果你不越狱，几乎就不存在这些问题。但是我们还是在研究这些问题，为的是从逆向的角度考虑，尽可能的给用户创造一个安全的使用环境。App安全在国内还是很少人关注的，绝大多数App都在裸奔中。不过也确实有进步，据说曾经有些App竟然把一些重要信息存在plist中，太发指了，plist文件不用越狱都可以拿到。那是不是应该存到keychain中呢？是的，目前多数都是这么做的，但是实际上，如果上手段，keychain中的数据也是可以拿到的哦。

话说回来，对于iOS的逆向，虽然上面的工具手段都很强大，但能否尽快尽有效的获取我们想要的信息很大程度上取决于一个破解者的经验。毕竟从一大堆信息里扒拉东西是个体力活啊。

最后，放个系列教程，[iOS应用程序安全简要总结](http://wufawei.com/2013/11/ios-application-security-summary/)

